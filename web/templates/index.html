<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
  <title>{{.AppName}}</title>
  <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg"/>
  <meta name="theme-color" content="#0c121c"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <link rel="stylesheet" href="/static/css/public-bundle.css?v={{.CSSVersion}}"/>
  {{if .IsAdmin}}
  <link rel="stylesheet" href="/static/css/admin-bundle.css?v={{.CSSVersion}}"/>
  {{end}}
  <script src="/static/js/public-bundle.js?v={{.JSVersion}}" defer></script>
  {{if .IsAdmin}}
  <script src="/static/js/admin-bundle.js?v={{.JSVersion}}" defer></script>
  {{end}}
</head>
<body>
  <!-- Site Alerts Banner -->
  <div id="siteAlerts"></div>

  <header>
    <div class="brand">
      <span class="health-dot" id="healthDot" title="System health"></span>
      <h1 id="appTitle">{{.AppName}}</h1>
      <div class="view-toggle-bar">
        <button class="view-toggle-btn active" id="viewCards" title="Card view">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="1" width="6" height="6" rx="1"/><rect x="9" y="1" width="6" height="6" rx="1"/><rect x="1" y="9" width="6" height="6" rx="1"/><rect x="9" y="9" width="6" height="6" rx="1"/></svg>
        </button>
        <button class="view-toggle-btn" id="viewMatrix" title="Network topology view">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3"><circle cx="8" cy="8" r="1.8" fill="currentColor"/><circle cx="3" cy="3" r="1.3"/><circle cx="13" cy="3" r="1.3"/><circle cx="3" cy="13" r="1.3"/><circle cx="13" cy="13" r="1.3"/><circle cx="2" cy="8" r="1.3"/><circle cx="14" cy="8" r="1.3"/><line x1="8" y1="8" x2="3" y2="3" stroke-width="0.6"/><line x1="8" y1="8" x2="13" y2="3" stroke-width="0.6"/><line x1="8" y1="8" x2="3" y2="13" stroke-width="0.6"/><line x1="8" y1="8" x2="13" y2="13" stroke-width="0.6"/><line x1="8" y1="8" x2="2" y2="8" stroke-width="0.6"/><line x1="8" y1="8" x2="14" y2="8" stroke-width="0.6"/></svg>
        </button>
      </div>
    </div>
    <div class="header-right">
      <span class="last-updated" id="lastUpdated">Updated <span id="updated">—</span></span>
      <div class="user">
        <span id="welcome" class="muted">Public view</span>
        <button id="loginBtn" class="ghost">Login</button>
        <button id="logoutBtn" class="ghost hidden">Logout</button>
      </div>
    </div>
  </header>

  <!-- Status Summary Bar -->
  <div class="status-summary" id="statusSummary"></div>

  <main>
    <!-- Dynamic service cards will be rendered here by JavaScript -->
    <div id="services-container"></div>

    <!-- Matrix network graph (hidden by default) -->
    <div id="matrix-container" class="matrix-container hidden"></div>

    <section class="card fade-in incidents-card">
      <div class="row"><div><strong>Recent incidents</strong><div class="label">Last 24h</div></div></div>
      <ul id="incidents"></ul>
    </section>
  </main>

  {{template "resources" .}}

  <!-- Full-width Uptime Section -->
  <section class="card uptime-section">
    <div class="row">
      <div>
        <strong>Uptime</strong>
        <div class="label" id="window">Last 30 days</div>
      </div>
      <select id="uptimeFilter" class="uptime-filter">
        <option value="7">Last 7 days</option>
        <option value="30" selected>Last 30 days</option>
        <option value="90">Last 90 days</option>
        <option value="180">Last 180 days</option>
        <option value="360">Last 360 days</option>
      </select>
    </div>
    
    <!-- Dynamic uptime bars will be rendered here -->
    <div id="uptime-bars-container"></div>
    
    <div class="uptime-footer">
      <span class="uptime-timestamp" id="timestamp-global">—</span>
    </div>
  </section>

  {{if .IsAdmin}}
  <!-- Admin Panel with Tabs -->
  <section id="adminPanel" class="admin-panel admin hidden">
    <div class="admin-tabs">
      <button class="tab-btn active" data-tab="services">Services</button>
      <button class="tab-btn" data-tab="banners">Banners</button>
      <button class="tab-btn" data-tab="logs">Logs</button>
      <button class="tab-btn" data-tab="security">Security</button>
      <button class="tab-btn" data-tab="resources">Resources</button>
      <button class="tab-btn" data-tab="alerts">Notifications</button>
      <button class="tab-btn" data-tab="settings">Settings</button>
    </div>

    {{template "admin-services-banners" .}}
    {{template "admin-logs" .}}
    {{template "admin-security-resources" .}}
    {{template "admin-alerts" .}}
    {{template "admin-settings" .}}
  </section>
  {{end}}

  {{template "modals" .}}

  <footer>Auto-refreshing every 15s. Metrics need a few minutes to populate.</footer>
</body>
</html>
