{{define "modals"}}
<!-- Login Modal -->
<dialog id="loginModal" class="login-dialog">
  <form class="login-form" autocomplete="on">
    <div class="login-header">
      <div class="login-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
          <polyline points="10 17 15 12 10 7"/>
          <line x1="15" y1="12" x2="3" y2="12"/>
        </svg>
      </div>
      <h3>Welcome back</h3>
      <p>Sign in to access admin panel</p>
    </div>
    <div class="login-fields">
      <div class="form-field">
        <label for="u">Username</label>
        <input id="u" type="text" autocomplete="username" placeholder="Enter username" required>
      </div>
      <div class="form-field">
        <label for="p">Password</label>
        <input id="p" type="password" autocomplete="current-password" placeholder="Enter password" required>
      </div>
    </div>
    <div id="loginError" class="login-error hidden"></div>
    <div class="login-actions">
      <button id="doLogin" class="btn primary" type="button">Sign In</button>
      <button id="cancelLogin" class="btn secondary" type="button">Cancel</button>
    </div>
  </form>
</dialog>

{{if .IsAdmin}}
<!-- Service Add/Edit Modal (Admin Only) -->
<dialog id="serviceModal">
  <form class="service-form">
    <div class="modal-header">
      <h3 id="serviceModalTitle">Add Service</h3>
      <button type="button" class="close-btn" id="closeServiceModal">&times;</button>
    </div>
    
    <div class="form-group">
      <label for="serviceTemplate">Service Template</label>
      <select id="serviceTemplate">
        <option value="">-- Select a template (optional) --</option>
      </select>
      <small class="help-text" id="templateHelp"></small>
    </div>
    
    <div class="form-group">
      <label for="serviceName">Name *</label>
      <input type="text" id="serviceName" placeholder="e.g., My Plex Server" autocomplete="off" required>
    </div>
    
    <div class="form-group">
      <label for="serviceUrl">URL *</label>
      <input type="text" id="serviceUrl" placeholder="e.g., http://192.168.1.100:32400" autocomplete="off" required>
      <small class="help-text">TCP: tcp://host:port | DNS: dns://hostname</small>
    </div>
    
    <div class="form-group" id="tokenGroup">
      <label for="serviceToken">API Token</label>
      <input type="text" id="serviceToken" placeholder="Optional API token or key" autocomplete="off">
      <small class="help-text" id="tokenHelp">Some services require an API token for authentication</small>
    </div>
    
    <div class="form-group">
      <label for="serviceIconUrl">Custom Icon URL</label>
      <div class="icon-url-row">
        <input type="text" id="serviceIconUrl" placeholder="https://example.com/icon.svg" autocomplete="off">
        <div id="iconPreview" class="icon-preview hidden"></div>
      </div>
      <small class="help-text">Optional: Enter a URL to a custom icon image (SVG, PNG, etc.)</small>
    </div>
    
    <details class="advanced-settings">
      <summary>Advanced Settings</summary>
      
      <div class="form-group">
        <label for="serviceCheckType">Check Type</label>
        <select id="serviceCheckType">
          <option value="http">HTTP/HTTPS</option>
          <option value="tcp">TCP Port</option>
          <option value="dns">DNS Lookup</option>
          <option value="always_up">Always Up (Demo)</option>
        </select>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="serviceTimeout">Timeout (seconds)</label>
          <input type="number" id="serviceTimeout" value="5" min="1" max="60">
        </div>
        
        <div class="form-group">
          <label for="serviceInterval">Check Interval (seconds)</label>
          <input type="number" id="serviceInterval" value="60" min="10" max="3600">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="serviceExpectedMin">Expected Status Min</label>
          <input type="number" id="serviceExpectedMin" value="200" min="100" max="599">
        </div>
        
        <div class="form-group">
          <label for="serviceExpectedMax">Expected Status Max</label>
          <input type="number" id="serviceExpectedMax" value="399" min="100" max="599">
        </div>
      </div>
      
      <div class="form-group">
        <label>
          <input type="checkbox" id="serviceVisible" checked>
          Show on public dashboard
        </label>
      </div>
      
      <div class="form-group">
        <label>Depends On</label>
        <div id="serviceDependsOnList" class="depends-on-checklist">
          <!-- Populated dynamically with checkboxes -->
        </div>
        <small class="help-text">Select upstream dependencies. Alerts are suppressed when a dependency is down.</small>
      </div>

      <div class="form-group">
        <label>Connected To</label>
        <div id="serviceConnectedToList" class="depends-on-checklist">
          <!-- Populated dynamically with checkboxes -->
        </div>
        <small class="help-text">Select services that share data or are integrated with this one.</small>
      </div>
    </details>
    
    <input type="hidden" id="serviceId">
    <input type="hidden" id="serviceType">
    
    <div id="testConnectionResult" class="test-result hidden"></div>
    
    <div class="modal-actions">
      <button type="button" id="testServiceConnection" class="btn ghost">Test Connection</button>
      <button type="button" id="saveService" class="btn">Save Service</button>
      <button type="button" id="cancelService" class="ghost">Cancel</button>
      <button type="button" id="deleteService" class="btn danger hidden">Delete</button>
    </div>
    
    <div id="serviceError" class="error hidden"></div>
  </form>
</dialog>

<!-- Database Reset Confirmation Dialog (Admin Only) -->
<dialog id="confirmResetDialog" class="confirm-dialog">
  <h3>‚ö†Ô∏è Reset Database</h3>
  <p>This will permanently delete all services, settings, historical data, and reset the application to its initial state. This action cannot be undone.</p>
  <form id="confirmResetForm">
    <input type="text" name="username" autocomplete="username" value="admin" class="hidden" aria-hidden="true" tabindex="-1">
    <div class="form-group">
      <label for="confirmResetPassword">Enter your password to confirm:</label>
      <input type="password" id="confirmResetPassword" placeholder="Enter admin password" autocomplete="current-password" required>
    </div>
    <div id="resetDbError" class="error hidden"></div>
    <div class="actions">
      <button type="button" id="cancelResetDb" class="ghost">Cancel</button>
      <button type="button" id="confirmResetDb" class="btn danger">Reset Database</button>
    </div>
  </form>
</dialog>

<!-- Import Confirmation Dialog (Admin Only) -->
<dialog id="confirmImportDialog" class="confirm-dialog">
  <h3>üì• Import Database</h3>
  <p>This will replace your current data with the imported backup. Your current services, settings, and historical data will be overwritten.</p>
  <div class="form-group">
    <label>Selected file: <span id="importFileName">-</span></label>
  </div>
  <div id="importDbError" class="error hidden"></div>
  <div class="actions">
    <button type="button" id="cancelImportDb" class="ghost">Cancel</button>
    <button type="button" id="confirmImportDb" class="btn">Import & Overwrite</button>
  </div>
</dialog>
{{end}}

<!-- Day Detail Popup (Hourly Breakdown) -->
<dialog id="dayDetailDialog" class="day-detail-dialog">
  <div class="day-detail-header">
    <h3 id="dayDetailTitle">Hourly Breakdown</h3>
    <button type="button" class="close-btn" id="closeDayDetail">&times;</button>
  </div>
  <div id="dayDetailContent" class="day-detail-content">
    <div class="day-detail-hours" id="dayDetailHours"></div>
    <div class="day-detail-events" id="dayDetailEvents"></div>
  </div>
</dialog>
{{end}}
